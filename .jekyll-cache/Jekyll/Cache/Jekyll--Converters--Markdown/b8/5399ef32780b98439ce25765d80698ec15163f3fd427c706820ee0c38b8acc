I"<p>Un client avec un besoin concernant lâ€™optimisation de la distribution de prospectus spÃ©cialisÃ©s. En effet, les circuits de livraison avaient Ã©tÃ© rÃ©alisÃ©s il y a plusieurs annÃ©es. Les nouveaux prospects se sont peu Ã  peu ajoutÃ©s aux livraisons mais sans politique dâ€™optimisation. Au bout de quelques annÃ©es il Ã©tait nÃ©cessaire dâ€™identifier les tournÃ©es potentiellement problÃ©matiques.</p>

<h2 id="Ã©tape-1--gÃ©ocodage-des-prospects">Ã‰tape 1 : GÃ©ocodage des prospects</h2>

<p>La premiÃ¨re Ã©tape fut de gÃ©ocoder les <strong>260 000</strong> prospects. Le gÃ©ocodage consiste en la traduction dâ€™une adresse postale en coordonnÃ©es XY, nÃ©cessaires pour les traitement et la reprÃ©sentation gÃ©ographique.</p>

<p>Pour cela jâ€™ai utilisÃ© lâ€™API de <a href="https://geo.api.gouv.fr/adresse">adresse.gouv.fr</a></p>

<p><a href="https://prrojet-tests-covid.nw.r.appspot.com/"><img src="/assets/img/homepage-test-covid.png" alt="AccÃ©der au site" /></a></p>

<h2 id="comment-cette-application-a-Ã©tÃ©-construite-">Comment cette application a Ã©tÃ© construite ?</h2>

<h3 id="source-des-donnÃ©es">Source des donnÃ©es</h3>

<p>Les donnÃ©es sont des donnÃ©es publiques disponibles sur data.gouv.fr. Câ€™est une base au format CSV qui recense les centres de dÃ©psitages avec leur localisation et des informations complÃ©mentaires (numÃ©ro de tÃ©lÃ©phone, site internet â€¦) :</p>

<blockquote>
  <p><a href="https://www.data.gouv.fr/fr/datasets/sites-de-prelevements-pour-les-tests-covid/">https://www.data.gouv.fr/fr/datasets/sites-de-prelevements-pour-les-tests-covid/</a></p>
</blockquote>

<h3 id="enrichissement-et-stockage-des-donnÃ©es">Enrichissement et stockage des donnÃ©es</h3>

<p>Les donnÃ©es sont stockÃ©es sur une baseÂ <strong>BigQuery (Google Cloud Platform)</strong>. GrÃ¢ce aux champs de latitude et de longitude, un nouveau champ Geometry a Ã©tÃ© crÃ©Ã©. Celui-ci est indispensable pour retrouver les centres de dÃ©pistage les plus proches dans lâ€™application.</p>

<h3 id="fonctionnement-de-lapplication">Fonctionnement de lâ€™application</h3>

<p>Lâ€™application est contruite en Python avecÂ <strong>Flask</strong>Â et le FrameworkÂ <strong>Materialize</strong>Â pour le rendu.</p>

<h4 id="Ã©tape-1--rÃ©cupÃ©ration-des-coordonnÃ©es-gÃ©ographiques">Ã‰tape 1 : RÃ©cupÃ©ration des coordonnÃ©es gÃ©ographiques</h4>

<p>Une fois lâ€™adresse postale envoyÃ©e, une requÃªte est envoyÃ©e Ã  lâ€™API deÂ <a href="https://geo.api.gouv.fr/adresse">adresse.gouv.fr</a>Â pour rÃ©cupÃ©rer les coordonnÃ©es XY.</p>

<h4 id="Ã©tape-2--requÃªter-les-centres-de-dÃ©pistage-les-plus-proches">Ã‰tape 2 : RequÃªter les centres de dÃ©pistage les plus proches</h4>

<p>Une fois les coordonnÃ©es XY rÃ©cupÃ©rÃ©es, La baseÂ <strong>BigQuery</strong>Â est requÃªtÃ©e grÃ¢ce Ã  la fonctionÂ <em>ST_DISTANCE</em>Â pour renvoyer les 10 rÃ©sultats les plus proches, leurs attributs, ainsi que la distance calculÃ©e.</p>

<h4 id="Ã©tape-3--rendu-dans-lapplication">Ã‰tape 3 : Rendu dans lâ€™application</h4>

<p>Une fois les centres de dÃ©pistage les plus proches rÃ©cupÃ©rÃ©s, Flask crÃ©Ã© un JSON et le renvoie sur la page de rÃ©sultats. La page est alors gÃ©nÃ©rÃ©e grÃ¢ce au moteur de rendu de Flask (template Jinja2) et une card est crÃ©Ã©e pour chaque Ã©tablissement.</p>

<p>Il est Ã©galement possible de rÃ©cupÃ©rer les rÃ©sultats au format JSON.Â <a href="https://prrojet-tests-covid.nw.r.appspot.com/api">Voir le fonctionnement de lâ€™API</a></p>

<h3 id="hÃ©bergement">HÃ©bergement</h3>

<p>Lâ€™application Flask est hÃ©gergÃ©e surÂ <strong>Google App Engine</strong></p>

:ET